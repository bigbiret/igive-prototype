---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Send gavekort - iGive">
  <Header />
  <main class="site-content bg-gradient-to-b from-gray-50 to-white min-h-screen">
    <!-- Success banner with animation -->
    <div class="bg-green-50 border-b border-green-200 animate-slideDown">
      <div class="container mx-auto px-4 max-w-6xl py-4">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center animate-checkmark">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
          <div>
            <p class="text-green-800 font-semibold">Betaling godkjent!</p>
            <p class="text-green-700 text-sm">Bestillingsnummer: #2024-1234</p>
          </div>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-4 max-w-7xl py-8">
      <!-- Progress indicator with enhanced visuals -->
      <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8 mb-8">
        <div class="relative">
          <div class="absolute top-5 left-0 right-0 h-1 bg-gray-200 rounded-full">
            <div class="h-full w-2/3 bg-gradient-to-r from-[#D4A574] to-[#C49560] rounded-full animate-progressFill"></div>
          </div>
          
          <div class="relative flex justify-between">
            <div class="flex flex-col items-center animate-fadeInUp" style="animation-delay: 0.1s">
              <div class="w-12 h-12 bg-gradient-to-br from-[#D4A574] to-[#C49560] text-white rounded-full flex items-center justify-center shadow-lg z-10 transform transition-transform hover:scale-110">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <span class="mt-3 text-sm font-medium text-gray-900">Velg beløp/antall</span>
            </div>
            
            <div class="flex flex-col items-center animate-fadeInUp" style="animation-delay: 0.2s">
              <div class="w-12 h-12 bg-gradient-to-br from-[#D4A574] to-[#C49560] text-white rounded-full flex items-center justify-center shadow-lg z-10 transform transition-transform hover:scale-110">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <span class="mt-3 text-sm font-medium text-gray-900">Betal</span>
            </div>
            
            <div class="flex flex-col items-center animate-fadeInUp" style="animation-delay: 0.3s">
              <div class="w-12 h-12 bg-gradient-to-br from-[#D4A574] to-[#C49560] text-white rounded-full flex items-center justify-center font-bold shadow-lg z-10 transform transition-transform hover:scale-110 animate-pulse">
                3
              </div>
              <span class="mt-3 text-sm font-medium text-gray-900">Send gavekort</span>
            </div>
          </div>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left column - Interactive Distribution -->
        <div class="lg:col-span-2">
          <div class="mb-8 animate-fadeInUp">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Send gavekortene dine</h1>
            <p class="text-gray-600">Velg hvordan du ønsker å distribuere gavekortene</p>
          </div>
          
          <!-- Quantity selector -->
          <div class="bg-white rounded-xl border-2 border-gray-200 p-6 mb-6">
            <h3 class="font-semibold text-gray-900 mb-4">Velg antall gavekort som skal sendes</h3>
            
            <!-- Simple two-option selector -->
            <div class="flex gap-3">
              <button 
                type="button" 
                class="quantity-btn flex-1 px-6 py-4 border-2 border-gray-200 rounded-lg font-semibold text-gray-700 hover:border-[#D4A574] hover:bg-[#FDF9F5] transition-all text-lg"
                data-quantity="all"
              >
                <span id="total-cards-text">10</span>
              </button>
              
              <input 
                type="number" 
                id="custom-quantity-input" 
                min="1" 
                max="10" 
                placeholder="Velg selv"
                class="flex-1 px-6 py-4 border-2 border-gray-200 rounded-lg font-semibold text-gray-700 hover:border-[#D4A574] focus:border-[#D4A574] focus:bg-[#FDF9F5] focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 transition-all text-lg text-center" 
              />
            </div>
          </div>

          <!-- Dynamic quantity display -->
          <div id="quantity-display" class="bg-gradient-to-r from-[#D4A574]/10 to-[#C49560]/10 rounded-lg p-4 mb-6 border border-[#D4A574]/20">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs text-gray-600">Du sender</p>
                <p class="text-lg font-semibold text-gray-900"><span id="card-count">10</span> gavekort</p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-600">Totalverdi</p>
                <p class="text-lg font-semibold text-[#C49560]">kr <span id="total-value">5.000</span></p>
              </div>
            </div>
          </div>

          <!-- Interactive delivery method selector -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Velg leveringsmetode</h3>
            <div id="delivery-cards" class="grid gap-4">
              <!-- Cards will be inserted dynamically -->
            </div>
          </div>

          <!-- Dynamic form container -->
          <div id="form-container" class="mb-8">
            <!-- Forms will be inserted here based on selection -->
          </div>

          <!-- Enhanced action buttons -->
          <div class="flex gap-4">
            <button class="px-8 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-all transform hover:scale-[1.02]">
              <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Tilbake
            </button>
            <button id="send-btn" class="flex-1 py-3 bg-gradient-to-r from-[#D4A574] to-[#C49560] text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed group">
              <span class="group-hover:scale-105 inline-block transition-transform">Send gavekort</span>
              <svg class="w-5 h-5 inline ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Right column - Preview -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl p-6 shadow-xl border border-gray-100 sticky top-4">
            <!-- Preview section for SMS -->
            <div id="sms-preview-section" class="hidden">
              <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Forhåndsvisning</h3>
              
              <!-- iPhone preview -->
              <div id="sms-preview-container" class="mb-6">
                <!-- SMS preview will be inserted here -->
              </div>
              
              <!-- Gift card count -->
              <div class="bg-gray-50 rounded-xl p-4 text-center">
                <p class="text-sm text-gray-600 mb-1">Du sender</p>
                <p class="text-2xl font-bold text-gray-900"><span id="preview-card-count">1</span> gavekort</p>
              </div>
            </div>
            
            <!-- Preview section for PDF -->
            <div id="pdf-preview-section" class="hidden">
              <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Forhåndsvisning</h3>
              
              <!-- PDF preview -->
              <div id="pdf-preview-container" class="mb-6">
                <!-- PDF preview will be inserted here -->
              </div>
              
              <!-- Gift card count -->
              <div class="bg-gray-50 rounded-xl p-4 text-center">
                <p class="text-sm text-gray-600 mb-1">Du sender</p>
                <p class="text-2xl font-bold text-gray-900"><span id="pdf-preview-card-count">1</span> gavekort</p>
              </div>
            </div>
            
            <!-- Default content for initial state -->
            <div id="default-sidebar">
              <h3 class="text-lg font-bold text-gray-900 mb-4">Din bestilling</h3>
              
              <!-- Stats -->
              <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-50 rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-gray-900" id="stat-count">10</p>
                  <p class="text-xs text-gray-600">Gavekort</p>
                </div>
                <div class="bg-[#FDF9F5] rounded-xl p-4 text-center">
                  <p class="text-2xl font-bold text-[#C49560]" id="stat-value">5K</p>
                  <p class="text-xs text-gray-600">Total verdi</p>
                </div>
              </div>
              
              <!-- Help -->
              <div class="border-t pt-6">
                <h4 class="font-semibold text-gray-900 text-sm mb-3">Trenger du hjelp?</h4>
                <div class="space-y-2">
                  <a href="#" class="flex items-center gap-2 text-xs text-blue-600 hover:text-blue-700">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    support@igive.no
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<style>
  @keyframes slideDown {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  @keyframes fadeInUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes checkmark {
    0% { transform: scale(0) rotate(45deg); }
    50% { transform: scale(1.2) rotate(45deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  
  @keyframes progressFill {
    from { width: 0; }
    to { width: 66.666667%; }
  }
  
  .animate-slideDown {
    animation: slideDown 0.5s ease-out;
  }
  
  .animate-fadeInUp {
    animation: fadeInUp 0.5s ease-out forwards;
    opacity: 0;
  }
  
  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }
  
  .animate-checkmark {
    animation: checkmark 0.5s ease-out;
  }
  
  .animate-progressFill {
    animation: progressFill 1s ease-out forwards;
  }
  
  .perspective-1000 {
    perspective: 1000px;
  }
  
  .gift-card-3d:hover {
    transform: rotateY(5deg) rotateX(-5deg);
  }
  
  .delivery-card {
    transition: all 0.3s ease;
  }
  
  .delivery-card:hover {
    transform: translateY(-4px);
  }
  
  .delivery-card.selected {
    transform: scale(1.02);
  }
</style>

<script>
  // Order data from previous step (in real app this would come from state/session)
  const orderData = {
    totalQuantity: 10,  // Total purchased
    valuePerCard: 500,
    totalPaid: 5200
  };
  
  // Current selection
  let selectedQuantity = orderData.totalQuantity;

  // Update initial displays
  document.getElementById('total-cards-text')!.textContent = orderData.totalQuantity.toString();
  document.getElementById('card-count')!.textContent = selectedQuantity.toString();
  document.getElementById('total-value')!.textContent = (selectedQuantity * orderData.valuePerCard).toLocaleString('nb-NO');
  document.getElementById('stat-count')!.textContent = selectedQuantity.toString();
  document.getElementById('stat-value')!.textContent = ((selectedQuantity * orderData.valuePerCard) / 1000) + 'K';
  
  // Get elements
  const allButton = document.querySelector('[data-quantity="all"]') as HTMLElement;
  const customQuantityInput = document.getElementById('custom-quantity-input') as HTMLInputElement;
  
  // Set max on custom input
  if (customQuantityInput) {
    customQuantityInput.max = orderData.totalQuantity.toString();
  }

  // Function to update selection states
  function updateSelectionState(isAll: boolean) {
    if (isAll) {
      allButton.classList.remove('border-gray-200');
      allButton.classList.add('border-[#D4A574]', 'bg-[#FDF9F5]');
      customQuantityInput.classList.remove('border-[#D4A574]', 'bg-[#FDF9F5]');
      customQuantityInput.classList.add('border-gray-200');
      customQuantityInput.value = '';
    } else {
      allButton.classList.remove('border-[#D4A574]', 'bg-[#FDF9F5]');
      allButton.classList.add('border-gray-200');
      customQuantityInput.classList.remove('border-gray-200');
      customQuantityInput.classList.add('border-[#D4A574]', 'bg-[#FDF9F5]');
    }
  }
  
  // Handle "all" button click
  allButton?.addEventListener('click', () => {
    updateQuantityDisplay(orderData.totalQuantity);
    updateSelectionState(true);
  });
  
  // Handle custom quantity input
  customQuantityInput?.addEventListener('focus', () => {
    updateSelectionState(false);
  });
  
  customQuantityInput?.addEventListener('input', (e) => {
    const target = e.target as HTMLInputElement;
    const value = parseInt(target.value);
    if (value >= 1 && value <= orderData.totalQuantity) {
      updateQuantityDisplay(value);
      updateSelectionState(false);
    }
  });
  
  // Initialize with "all" selected
  updateSelectionState(true);
  
  function updateQuantityDisplay(quantity: number) {
    selectedQuantity = quantity;
    const totalValue = quantity * orderData.valuePerCard;
    
    document.getElementById('card-count')!.textContent = quantity.toString();
    document.getElementById('total-value')!.textContent = totalValue.toLocaleString('nb-NO');
    document.getElementById('stat-count')!.textContent = quantity.toString();
    document.getElementById('stat-value')!.textContent = (totalValue / 1000) + 'K';
    
    // Reset delivery methods when quantity changes
    setupDeliveryMethods();
    
    // Clear any selected form
    const formContainer = document.getElementById('form-container');
    if (formContainer) {
      formContainer.innerHTML = '';
    }
    
    // Hide method indicator
    document.getElementById('method-indicator')?.classList.add('hidden');
    
    // Reset preview
    document.getElementById('no-preview')?.classList.remove('hidden');
    document.getElementById('card-preview')?.classList.add('hidden');
  }

  // Setup delivery methods based on quantity
  function setupDeliveryMethods() {
    const container = document.getElementById('delivery-cards');
    if (!container) return;

    let methods = [];
    
    if (selectedQuantity > 5) {
      // Over 5 cards - PDF with QR code and PDF with retrieval codes
      methods = [
        {
          id: 'pdf-qr',
          icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>`,
          title: 'FÅ PDF-FIL PÅ E-POST',
          description: 'PDF med QR-koder for utskrift',
          badge: 'QR-kode'
        },
        {
          id: 'pdf-code',
          icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>`,
          title: 'HENTEKODER PÅ E-POST',
          description: 'PDF med hentekoder for Mine Gavekort',
          badge: 'Hentekode'
        }
      ];
    } else {
      // 5 or fewer cards - SMS and PDF with QR only (no PDF with codes)
      methods = [
        {
          id: 'sms',
          icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>`,
          title: 'HENTEKODER PÅ SMS',
          description: 'Send hentekoder direkte til mottaker',
          badge: 'Rask levering'
        },
        {
          id: 'pdf-qr',
          icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>`,
          title: 'FÅ PDF-FIL PÅ E-POST',
          description: 'PDF med QR-koder for utskrift',
          badge: 'QR-kode'
        }
      ];
    }

    container.innerHTML = methods.map(method => `
      <div class="delivery-card bg-white rounded-xl border-2 border-gray-200 p-6 cursor-pointer hover:border-[#D4A574] hover:shadow-lg" data-method="${method.id}">
        <div class="flex items-start gap-4">
          <div class="w-14 h-14 bg-gradient-to-br from-[#D4A574]/20 to-[#C49560]/20 rounded-xl flex items-center justify-center flex-shrink-0">
            <svg class="w-7 h-7 text-[#C49560]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              ${method.icon}
            </svg>
          </div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <h3 class="font-semibold text-gray-900 text-lg">${method.title}</h3>
              ${method.badge ? `<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">${method.badge}</span>` : ''}
            </div>
            <p class="text-sm text-gray-600">${method.description}</p>
          </div>
          <svg class="w-6 h-6 text-gray-400 check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
      </div>
    `).join('');

    // Add click handlers
    document.querySelectorAll('.delivery-card').forEach(card => {
      card.addEventListener('click', () => selectDeliveryMethod(card));
    });
  }

  function selectDeliveryMethod(card: HTMLElement) {
    // Update visual state
    document.querySelectorAll('.delivery-card').forEach(c => {
      c.classList.remove('selected', 'border-[#D4A574]', 'bg-[#FDF9F5]');
      c.classList.add('border-gray-200');
      c.querySelector('.check-icon')?.classList.add('hidden');
    });
    
    card.classList.add('selected', 'border-[#D4A574]', 'bg-[#FDF9F5]');
    card.classList.remove('border-gray-200');
    card.querySelector('.check-icon')?.classList.remove('hidden');
    
    const method = card.dataset.method;
    
    // Update preview
    updatePreview(method!);
    
    // Show form
    showForm(method!);
    
    // Update method indicator
    updateMethodIndicator(method!);
  }

  function updatePreview(method: string) {
    const smsPreviewContainer = document.getElementById('sms-preview-container');
    const smsPreviewSection = document.getElementById('sms-preview-section');
    const pdfPreviewContainer = document.getElementById('pdf-preview-container');
    const pdfPreviewSection = document.getElementById('pdf-preview-section');
    const defaultSidebar = document.getElementById('default-sidebar');
    
    // Update preview counts
    const previewCount = document.getElementById('preview-card-count');
    const pdfPreviewCount = document.getElementById('pdf-preview-card-count');
    if (previewCount) previewCount.textContent = selectedQuantity.toString();
    if (pdfPreviewCount) pdfPreviewCount.textContent = selectedQuantity.toString();
    
    if (method === 'sms') {
      // Show SMS preview section
      if (smsPreviewSection) smsPreviewSection.classList.remove('hidden');
      if (pdfPreviewSection) pdfPreviewSection.classList.add('hidden');
      if (defaultSidebar) defaultSidebar.classList.add('hidden');
      
      // Show iPhone 15 SMS preview
      if (smsPreviewContainer) {
        smsPreviewContainer.innerHTML = `
          <div class="mx-auto" style="max-width: 280px;">
            <!-- iPhone 15 frame -->
            <div class="bg-black rounded-[2.75rem] p-[8px] shadow-2xl">
              <div class="bg-white rounded-[2.5rem] overflow-hidden">
                <!-- Dynamic Island -->
                <div class="relative h-[37px] bg-black">
                  <div class="absolute left-1/2 transform -translate-x-1/2 top-3 w-32 h-7 bg-black rounded-full"></div>
                </div>
                
                <!-- Status bar -->
                <div class="bg-white px-6 py-1 flex justify-between items-center text-xs -mt-6 relative z-10">
                  <span class="font-semibold text-black">9:41</span>
                  <div class="flex gap-1 items-center">
                    <svg class="w-4 h-3" viewBox="0 0 24 18" fill="currentColor">
                      <path d="M1 6l2-2v11a2 2 0 002 2h14a2 2 0 002-2V4l2 2V1h-5a2 2 0 00-2-2H8a2 2 0 00-2 2H1v5z"/>
                    </svg>
                    <svg class="w-4 h-3" viewBox="0 0 24 18" fill="currentColor">
                      <path d="M16 4l2 2v8a1 1 0 01-1 1H5a1 1 0 01-1-1V6l2-2h10z"/>
                    </svg>
                    <svg class="w-5 h-3" viewBox="0 0 24 18" fill="currentColor">
                      <rect x="1" y="6" width="18" height="10" rx="2"/>
                      <path d="M20 9v4" fill="white"/>
                      <rect x="21" y="8" width="2" height="6" rx="0.5"/>
                    </svg>
                  </div>
                </div>
                
                <!-- Messages header -->
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                  <div class="flex items-center justify-between">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    <div class="text-center">
                      <p class="font-semibold text-sm">Larvik By</p>
                      <p class="text-xs text-gray-500">SMS</p>
                    </div>
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                  </div>
                </div>
                
                <!-- Message content -->
                <div class="bg-white px-3 py-4" style="height: 380px; overflow-y: auto;">
                  <div class="flex justify-start mb-2">
                    <div class="bg-gray-200 rounded-2xl px-4 py-3 max-w-[90%]">
                      <p class="text-[13px] leading-[18px] text-gray-800 whitespace-pre-line"><span id="sms-sender-name">{Avsender}</span> har gitt deg et gavekort på verdi kr ${orderData.valuePerCard},-

Gavekortet ligger tilgjengelig i appen Mine Gavekort, som du laster ned fra App Store eller Google Play.

Din hentekode er:
XXX-XXX-XXX

Med vennlig hilsen,
Larvik By</p>
                    </div>
                  </div>
                  <p class="text-[11px] text-center text-gray-400 mt-1">Levert</p>
                </div>
                
                <!-- Input area -->
                <div class="bg-gray-100 px-3 py-2 flex items-center gap-2">
                  <div class="flex-1 bg-white rounded-full px-3 py-1.5 flex items-center">
                    <span class="text-gray-400 text-[13px]">iMessage</span>
                  </div>
                  <div class="w-7 h-7 bg-blue-500 rounded-full flex items-center justify-center">
                    <svg class="w-4 h-4 text-white transform rotate-45" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Update SMS preview when sender name changes
        setTimeout(() => {
          const senderInput = document.getElementById('sender-name-input') as HTMLInputElement;
          if (senderInput) {
            const updateSenderName = () => {
              const smsName = document.getElementById('sms-sender-name');
              if (smsName) {
                smsName.textContent = senderInput.value || '{Avsender}';
              }
            };
            senderInput.removeEventListener('input', updateSenderName); // Remove any existing listener
            senderInput.addEventListener('input', updateSenderName);
            updateSenderName(); // Initial update
          }
        }, 100);
      }
    } else if (method === 'pdf-qr' || method === 'pdf-code') {
      // Show PDF preview section
      if (pdfPreviewSection) pdfPreviewSection.classList.remove('hidden');
      if (smsPreviewSection) smsPreviewSection.classList.add('hidden');
      if (defaultSidebar) defaultSidebar.classList.add('hidden');
      
      // Show PDF preview
      if (pdfPreviewContainer) {
        const isQR = method === 'pdf-qr';
        pdfPreviewContainer.innerHTML = `
          <div class="mx-auto" style="max-width: 280px;">
            <!-- PDF document style container -->
            <div class="bg-white shadow-2xl rounded-sm" style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
              <!-- PDF page with A4 aspect ratio -->
              <div class="relative" style="padding-top: 141.4%;">
                <div class="absolute inset-0 bg-white flex flex-col">
                  <!-- Top section with rotated gavekort info and QR -->
                  <div class="relative px-4 py-3">
                    <!-- Upside down gavekort header with credit card number -->
                    <div class="transform rotate-180 mb-2">
                      <p class="text-[10px] text-gray-600">Gavekort er gyldig til og med 4. september 2028</p>
                      <p class="text-xs font-mono tracking-wider text-gray-700 mt-1">9578 4106 9332 8996 626</p>
                      <p class="text-xs text-gray-600 mt-1">CVC: 121</p>
                    </div>
                    
                    <!-- QR Code section smaller and positioned -->
                    <div class="flex justify-center mt-3">
                      <div class="w-24 h-24 bg-black p-1">
                        <div class="w-full h-full bg-white p-0.5">
                          <svg viewBox="0 0 29 29" class="w-full h-full">
                            <rect width="29" height="29" fill="white"/>
                            <path fill="black" d="M0,0h7v7h-7zM8,0h1v1h1v1h-2zM10,0h2v2h-1v-1h-1zM12,0h1v1h-1zM14,0h1v1h1v-1h1v3h-1v-1h-1v-1h-1zM18,0h1v1h-1zM20,0h2v1h1v-1h6v7h-7v-6h-1v2h-1zM1,1v5h5v-5zM23,1v5h5v-5zM2,2h3v3h-3zM9,2h1v1h-1zM11,2h1v1h1v1h-1v1h-1v1h-1v1h-1v-1h1v-2h1zM13,2h1v1h-1zM18,2h2v3h1v1h-2v1h-1v-2h-1v-1h1zM24,2h3v3h-3zM8,3h1v1h-1zM14,3h1v2h-1zM16,3h1v1h-1zM9,4h1v3h-1zM13,4h1v1h-1zM21,4h1v1h-1zM0,5h1v1h1v1h-2zM11,5h1v1h1v1h-2zM15,5h1v1h1v2h-2v1h1v1h-2v-1h-1v-1h1v-1h1zM2,6h1v1h-1zM6,6h1v1h-1zM19,6h1v1h-1zM21,6h1v1h-1zM3,7h2v1h-1v1h-1zM17,7h1v1h-1zM10,8h1v1h1v1h-1v1h1v-1h1v2h-1v1h1v1h-3v-1h1v-1h-1v-1h-1v-1h1zM13,8h2v1h-1v1h-1zM16,8h1v2h1v-2h2v1h1v1h1v1h-1v1h-2v1h-1v-1h-1v1h-1v1h-1v-2h1v-2h1v1h1v-1h-1v-1h-1zM23,8h3v1h1v1h1v1h-2v-1h-1v1h1v1h-1v1h-1v-1h-1v1h-1v1h1v-1h1v1h1v1h2v1h1v-1h1v2h-1v3h-1v-1h-1v-1h1v-1h-1v1h-1v-2h-2v1h1v2h-1v-1h-1v-1h-1v2h-1v1h-1v1h2v-1h2v1h-1v1h1v1h1v1h1v-2h1v2h1v1h-1v1h-1v1h-2v-2h-1v3h-1v-2h-1v-1h1v-1h-2v1h-1v-3h-1v-2h-1v-1h1v-1h1v1h1v-1h-1v-1h2v-1h1v-3h-1v2h-1v-2h1v-1h1v1h1v-1h1v-1h-1zM27,8h2v1h-2zM0,9h1v2h1v-1h1v2h-1v1h1v1h-1v1h1v-1h2v1h-1v1h2v-1h1v2h1v1h-1v1h-1v1h-1v-1h-1v2h-1v-2h-1v1h-1v-1h-1v-1h1v-1h-1v-1h1v-2h-1zM5,9h3v1h-1v1h-1v-1h-1zM18,9h1v1h-1zM8,10h1v1h1v1h-2zM26,10h1v1h-1zM4,11h2v1h-2zM28,11h1v1h-1zM6,12h1v1h1v-1h1v2h-1v1h1v1h-1v1h1v1h-2v-2h-1v1h-1v-1h-1v-1h2v-1h-1v-1h1zM14,12h1v1h-1zM25,13h1v1h1v1h-2zM27,13h1v1h-1zM10,14h2v1h-1v1h-1v1h1v1h-1v1h1v-1h1v-1h1v3h-1v1h1v1h1v2h-1v1h-1v-1h-1v-1h1v-1h-2v1h-1v-3h1v-1h1v-1h-1zM28,14h1v2h-1zM16,15h1v1h-1zM14,16h1v1h1v1h-2zM18,17h1v1h2v1h-3zM26,17h1v1h-1zM0,18h1v1h1v1h1v-1h1v1h1v2h-2v1h2v1h1v-1h-1v-1h1v-1h1v1h-1v3h-1v1h2v1h1v1h-1v1h-7v-7h1v-1h-1zM28,18h1v1h-1zM16,19h1v1h-1zM23,19h2v1h-1v1h-1zM14,20h1v1h-1zM25,20h1v1h1v1h1v-1h1v5h-1v-1h-1v1h-1v1h-1v-1h-1v-2h1v-1h1v-1h-1zM1,21v5h5v-5zM17,21h3v1h1v1h-1v1h2v-1h1v2h1v1h-2v1h2v1h1v-1h1v2h-4v-1h1v-1h-2v1h-1v-1h-1v-1h-1v1h-1v-3h1v1h1v-1h-1v-1h-1zM22,21h1v1h-1zM2,22h3v3h-3zM7,22h1v1h-1zM13,22h1v3h1v-2h1v4h-3v-1h1zM21,22h1v1h-1zM16,25h1v2h1v1h-2zM18,26h3v1h-1v1h1v1h-2v-1h-1zM22,26h1v1h1v2h-2zM6,27h2v1h1v1h-3zM26,27h1v1h1v1h-2zM10,28h1v1h-1zM20,28h1v1h-1z"/>
                          </svg>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Gavekort på 500 kr - rotert -->
                    <div class="transform rotate-180 text-center mt-2">
                      <p class="text-lg font-bold">500 kr</p>
                      <p class="text-xs text-gray-600">Gavekort på</p>
                    </div>
                  </div>
                  
                  <!-- Personal message on the right side -->
                  <div class="absolute right-2 top-20 w-32">
                    <p class="text-[9px] text-gray-600 italic leading-relaxed text-right" id="pdf-message" style="writing-mode: vertical-rl; text-orientation: mixed;">Hilsen
alle oss på jobb

Gratulerer så mye med bestått
dektorgradseksamen!</p>
                  </div>
                  
                  <!-- Stavanger Sentrum logo centered -->
                  <div class="flex flex-col items-center justify-center py-4">
                    <p class="text-sm font-bold text-gray-800 tracking-wider">STAVANGER</p>
                    <p class="text-sm font-bold text-gray-800 tracking-wider mb-2">SENTRUM</p>
                    <div class="w-10 h-10 rounded-full border-4 border-gray-800"></div>
                  </div>
                  
                  <!-- Instructions on left side -->
                  <div class="absolute left-2 top-48 w-28">
                    <h3 class="font-semibold text-[10px] mb-1 text-gray-900">Hvordan betale med gavekortet i butikk</h3>
                    <ol class="text-[8px] space-y-0.5 text-gray-700">
                      <li>1. Skann QR-koden på forrige side</li>
                      <li>2. Velg «Skann butikkens QR kode»</li>
                      <li>3. Skann butikkens QR-kode</li>
                      <li>4. Skriv inn beløp og utfør betaling</li>
                      <li>5. Vis kontrollbildet til betjeningen</li>
                    </ol>
                  </div>
                  
                  <!-- CONGRATS section with letter blocks -->
                  <div class="flex-1 flex items-center justify-center px-4">
                    <div class="relative w-full h-32">
                      <!-- Pink background with scattered letter blocks effect -->
                      <div class="absolute inset-0 bg-pink-100 rounded-lg overflow-hidden">
                        <!-- Random letter blocks -->
                        <div class="absolute top-2 left-3 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">M</div>
                        <div class="absolute top-4 right-5 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">S</div>
                        <div class="absolute bottom-3 left-6 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">W</div>
                        <div class="absolute top-8 left-12 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">B</div>
                        <div class="absolute bottom-5 right-8 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">Z</div>
                        <div class="absolute top-3 right-12 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">T</div>
                        <div class="absolute bottom-8 left-14 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">N</div>
                        <div class="absolute top-12 right-3 w-5 h-5 bg-white rounded shadow-sm flex items-center justify-center text-[8px] font-bold text-gray-700">O</div>
                        
                        <!-- CONGRATS letters in center -->
                        <div class="absolute inset-0 flex items-center justify-center">
                          <div class="flex gap-0.5">
                            <div class="w-5 h-5 bg-green-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">C</div>
                            <div class="w-5 h-5 bg-yellow-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">O</div>
                            <div class="w-5 h-5 bg-blue-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">N</div>
                            <div class="w-5 h-5 bg-red-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">G</div>
                            <div class="w-5 h-5 bg-purple-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">R</div>
                            <div class="w-5 h-5 bg-orange-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">A</div>
                            <div class="w-5 h-5 bg-pink-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">T</div>
                            <div class="w-5 h-5 bg-teal-500 rounded shadow-md flex items-center justify-center text-[8px] font-bold text-white">S</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- App download section compact -->
                  <div class="px-4 py-3 bg-gray-50">
                    <p class="text-[9px] mb-2 text-gray-700">Vi anbefaler at du lagrer dette gavekortet på din mobiltelefon ved å laste ned Mine Gavekort appen.</p>
                    
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-8 h-8 bg-[#D4A574] rounded flex items-center justify-center flex-shrink-0">
                        <span class="text-[10px] font-bold text-white">MG</span>
                      </div>
                      <div>
                        <p class="text-[9px] font-semibold">Med Mine Gavekort appen:</p>
                        <p class="text-[8px] text-gray-600">• Har du alltid gavekortet med deg</p>
                        <p class="text-[8px] text-gray-600">• Alltid oppdatert saldo</p>
                        <p class="text-[8px] text-gray-600">• Betaler du enkelt rett fra mobilen</p>
                      </div>
                    </div>
                    
                    <div class="flex gap-1">
                      <div class="bg-black text-white px-2 py-0.5 rounded text-[8px] flex items-center gap-1">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="white">
                          <path d="M18.71,19.5C17.88,20.74 17,21.95 15.66,21.97C14.32,22 13.89,21.18 12.37,21.18C10.84,21.18 10.37,21.95 9.1,22C7.79,22.05 6.8,20.68 5.96,19.47C4.25,17 2.94,12.45 4.7,9.39C5.57,7.87 7.13,6.91 8.82,6.88C10.1,6.86 11.32,7.75 12.11,7.75C12.89,7.75 14.37,6.68 15.92,6.84C16.57,6.87 18.39,7.1 19.56,8.82C19.47,8.88 17.39,10.1 17.41,12.63C17.44,15.65 20.06,16.66 20.09,16.67C20.06,16.74 19.67,18.11 18.71,19.5M13,3.5C13.73,2.67 14.94,2.04 15.94,2C16.07,3.17 15.6,4.35 14.9,5.19C14.21,6.04 13.07,6.7 11.95,6.61C11.8,5.46 12.36,4.26 13,3.5Z"/>
                        </svg>
                        App Store
                      </div>
                      <div class="bg-black text-white px-2 py-0.5 rounded text-[8px] flex items-center gap-1">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="white">
                          <path d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.16,10.81C20.5,11.08 20.75,11.5 20.75,12C20.75,12.5 20.53,12.9 20.18,13.18L17.89,14.5L15.39,12L17.89,9.5L20.16,10.81M6.05,2.66L16.81,8.88L14.54,11.15L6.05,2.66Z"/>
                        </svg>
                        Google Play
                      </div>
                    </div>
                  </div>
                  
                  <!-- Bottom GAVEKORT text -->
                  <div class="border-t-2 border-gray-200 bg-white py-3">
                    <h1 class="text-center text-2xl font-bold text-gray-800">GAVEKORT</h1>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- PDF shadow effect -->
            <div class="mt-1 h-1 bg-gradient-to-b from-gray-300 to-transparent opacity-50 rounded-b"></div>
          </div>
        `;
        
        // Update PDF preview when form fields change
        setTimeout(() => {
          const titleInput = document.querySelector('.pdf-title-input') as HTMLInputElement;
          const messageTextarea = document.querySelector('.pdf-message-input') as HTMLTextAreaElement;
          
          const updatePDFPreview = () => {
            const pdfTitle = document.getElementById('pdf-title');
            const pdfMessage = document.getElementById('pdf-message');
            
            if (pdfTitle && titleInput) {
              pdfTitle.textContent = titleInput.value || 'GAVEKORT';
            }
            if (pdfMessage && messageTextarea) {
              pdfMessage.textContent = messageTextarea.value || 'Din personlige melding vises her...';
            }
          };
          
          if (titleInput) {
            titleInput.removeEventListener('input', updatePDFPreview);
            titleInput.addEventListener('input', updatePDFPreview);
            updatePDFPreview();
          }
          if (messageTextarea) {
            messageTextarea.removeEventListener('input', updatePDFPreview);
            messageTextarea.addEventListener('input', updatePDFPreview);
            updatePDFPreview();
          }
        }, 100);
      }
    } else {
      // Show default sidebar for other options
      if (smsPreviewSection) smsPreviewSection.classList.add('hidden');
      if (pdfPreviewSection) pdfPreviewSection.classList.add('hidden');
      if (defaultSidebar) defaultSidebar.classList.remove('hidden');
    }
  }

  function updateMethodIndicator(method: string) {
    const indicator = document.getElementById('method-indicator');
    const details = document.getElementById('method-details');
    
    if (indicator && details) {
      indicator.classList.remove('hidden');
      
      const methodTexts: Record<string, string> = {
        'pdf-qr': 'PDF med QR-kode sendes til din e-post',
        'pdf-code': 'PDF med hentekoder sendes til din e-post',
        'sms': 'Hentekoder sendes via SMS til mottaker'
      };
      
      details.textContent = methodTexts[method];
    }
  }

  function showForm(method: string) {
    const container = document.getElementById('form-container');
    if (!container) return;
    
    let formHTML = '';
    
    if (method === 'pdf-qr') {
      formHTML = `
        <div id="pdf-qr-form" class="bg-white rounded-xl border border-gray-200 p-6 animate-fadeIn">
          <h3 class="font-semibold text-gray-900 mb-4">PDF-fil sendt med e-post</h3>
          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <p class="text-sm text-gray-600">Du vil motta en PDF-fil som kan skrives ut og brettes til et gratulasjonsKort. Den som får gavekortet benytter QR-koden til betaling eller for å lagre gavekortet på sin egen mobiltelefon i appen Mine Gavekort.</p>
            <p class="text-xs text-gray-500 mt-2">NB! Gavekortene blir sendt samlet i en PDF-fil. Om du ønsker gavekortene i separate filer, bestiller du sending av ett gavekort om gangen.</p>
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Din e-postadresse *</label>
              <input type="email" placeholder="din@epost.no" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574]">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Forsidetekst:</label>
              <input type="text" value="GAVEKORT" placeholder="GAVEKORT" class="pdf-title-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574]">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Personlig melding:</label>
              <textarea rows="5" placeholder="(Valgfritt) Skriv inn en personlig melding som legges inn på det utskriftsvennlige gavekortet. Eventuelt kan du la feltet stå tomt og heller skrive inn en melding for hånd etter du har skrevet ut gavekortet." class="pdf-message-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] resize-none text-sm"></textarea>
            </div>
          </div>
        </div>
      `;
    } else if (method === 'pdf-code') {
      formHTML = `
        <div id="pdf-code-form" class="bg-white rounded-xl border border-gray-200 p-6 animate-fadeIn">
          <h3 class="font-semibold text-gray-900 mb-4">PDF-fil sendt med e-post</h3>
          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <p class="text-sm text-gray-600">Du vil motta en PDF-fil med hentekoder. Mottakeren registrerer kodene i appen Mine Gavekort for å få tilgang til gavekortene.</p>
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Din e-postadresse *</label>
              <input type="email" placeholder="din@epost.no" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574]">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Forsidetekst:</label>
              <input type="text" value="GAVEKORT" placeholder="GAVEKORT" class="pdf-title-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574]">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Personlig melding:</label>
              <textarea rows="5" placeholder="(Valgfritt) Skriv inn en personlig melding som legges inn på det utskriftsvennlige gavekortet. Eventuelt kan du la feltet stå tomt og heller skrive inn en melding for hånd etter du har skrevet ut gavekortet." class="pdf-message-input w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] resize-none text-sm"></textarea>
            </div>
          </div>
        </div>
      `;
    } else if (method === 'sms') {
      let recipientsHTML = '';
      for (let i = 1; i <= selectedQuantity; i++) {
        recipientsHTML += `
          <div class="bg-gray-50 rounded-lg p-4 mb-3">
            <h4 class="text-sm font-medium text-gray-700 mb-3">Gavekort ${i}</h4>
            <div class="grid md:grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Mobilnummer</label>
                <input type="tel" placeholder="+47 000 00 000" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm">
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Navn (valgfritt)</label>
                <input type="text" placeholder="Mottakers navn" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm">
              </div>
            </div>
          </div>
        `;
      }
      
      formHTML = `
        <div class="bg-white rounded-xl border border-gray-200 p-6 animate-fadeIn">
          <h3 class="font-semibold text-gray-900 mb-4">Send hentekoder på SMS</h3>
          <div class="space-y-4">
            <div class="max-h-64 overflow-y-auto pr-2">
              ${recipientsHTML}
            </div>
            <div class="border-t pt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Avsendernavn</label>
              <input type="text" id="sender-name-input" placeholder="Ditt navn (maks 11 tegn)" maxlength="11" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574]">
            </div>
          </div>
        </div>
      `;
    }
    
    container.innerHTML = formHTML;
  }

  function toggleHelp() {
    const helpContent = document.getElementById('help-content');
    helpContent?.classList.toggle('hidden');
  }

  // Initialize
  setupDeliveryMethods();
</script>