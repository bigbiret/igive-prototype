---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
---

<Layout title="Kjøp Larvik By gavekort - iGive">
  <Header />
  <main class="site-content bg-gradient-to-b from-gray-50 to-white">
    <!-- Hero section with contained width -->
    <div class="container mx-auto px-4 max-w-6xl">
      <!-- Background image container -->
      <div class="relative h-64 md:h-80 lg:h-96 overflow-hidden rounded-b-2xl">
        <picture>
          <source media="(min-width: 768px)" srcset="/igive-prototype/larvik by.jpg">
          <img 
            src="/igive-prototype/larvik by.jpg" 
            alt="Larvik By"
            class="w-full h-full object-cover object-center"
            loading="eager"
            decoding="async"
            style="image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;"
          />
        </picture>
        <!-- Gradient overlay for better text contrast -->
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/10 to-black/40"></div>
        
        <!-- Logo positioned bottom left -->
        <div class="absolute bottom-6 left-6 md:bottom-8 md:left-8">
          <div class="bg-white rounded-xl p-3 shadow-xl">
            <img 
              src="/igive-prototype/larvik by logo.png" 
              alt="Larvik By logo"
              class="h-14 md:h-16 w-auto"
              loading="eager"
            />
          </div>
        </div>
      </div>
      
      <!-- Progress indicator below hero -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mt-6 mb-8">
        <div class="relative">
          <!-- Progress line -->
          <div class="absolute top-5 left-0 right-0 h-0.5 bg-gray-200">
            <div class="h-full w-1/3 bg-gradient-to-r from-[#D4A574] to-[#C49560]"></div>
          </div>
          
          <!-- Steps -->
          <div class="relative flex justify-between">
            <!-- Step 1: Active -->
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 bg-gradient-to-br from-[#D4A574] to-[#C49560] text-white rounded-full flex items-center justify-center font-bold text-sm shadow-lg z-10">
                1
              </div>
              <span class="mt-2 text-sm font-medium text-gray-900">Velg beløp/antall</span>
            </div>
            
            <!-- Step 2: Upcoming -->
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 bg-white border-2 border-gray-300 text-gray-400 rounded-full flex items-center justify-center font-bold text-sm z-10">
                2
              </div>
              <span class="mt-2 text-sm text-gray-500">Betal</span>
            </div>
            
            <!-- Step 3: Upcoming -->
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 bg-white border-2 border-gray-300 text-gray-400 rounded-full flex items-center justify-center font-bold text-sm z-10">
                3
              </div>
              <span class="mt-2 text-sm text-gray-500">Videresend/Last ned</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main content with focus on form -->
    <div class="container mx-auto px-4 max-w-6xl pb-8">

      <!-- Two column layout with form focus -->
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left column - Main form (2/3 width) -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Combined selection card -->
          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <!-- Velg antall -->
            <div class="mb-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4">Velg antall</h3>
              <div class="grid grid-cols-2 gap-3">
                <button class="quantity-btn py-4 px-6 bg-[#EDD4B8] text-gray-800 rounded-xl font-medium transition-all hover:bg-[#E5C9A8]">
                  <span class="text-lg">1</span>
                </button>
                <button class="quantity-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-lg">5</span>
                </button>
                <button class="quantity-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-lg">10</span>
                </button>
                <button class="quantity-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-base">Annet antall</span>
                </button>
              </div>
            </div>

            <!-- Divider -->
            <div class="border-t border-gray-200 my-6"></div>

            <!-- Velg beløp -->
            <div>
              <h3 class="text-lg font-bold text-gray-900 mb-4">Velg beløp</h3>
              <div class="grid grid-cols-2 gap-3">
                <button class="amount-btn py-4 px-6 bg-[#EDD4B8] text-gray-800 rounded-xl font-medium transition-all hover:bg-[#E5C9A8]">
                  <span class="text-lg">kr 250</span>
                </button>
                <button class="amount-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-lg">kr 500</span>
                </button>
                <button class="amount-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-lg">kr 1000</span>
                </button>
                <button class="amount-btn py-4 px-6 bg-white border-2 border-gray-800 text-gray-800 rounded-xl font-medium hover:bg-gray-50 transition-all">
                  <span class="text-base">Annet beløp</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Simple info text without card -->
          <div class="mt-6">
            <div class="flex items-start gap-2">
              <svg class="w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              <div class="space-y-1">
                <p class="text-xs text-gray-600 leading-relaxed">
                  Velg type gavekort og design etter fullført betaling. Gavekortet blir sendt til din e-post som hentekode til app eller som utskriftsvennlig PDF-fil.
                </p>
                <div class="flex gap-3">
                  <a href="#" class="text-xs text-blue-600 hover:text-blue-700 underline">Se eksempel på gavekort i app</a>
                  <span class="text-xs text-gray-400">•</span>
                  <a href="#" class="text-xs text-blue-600 hover:text-blue-700 underline">Se eksempel på utskriftsvennlig gavekort</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right column - Buyer info and summary (1/3 width) -->
        <div class="lg:col-span-1 space-y-6">
          <!-- Buyer information -->
          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Informasjon om kjøper</h3>
            <form class="space-y-4">
              <!-- Fornavn og etternavn på samme linje -->
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Fornavn *</label>
                  <input 
                    type="text" 
                    placeholder="Skriv inn fornavn"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm transition-all"
                    required
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Etternavn *</label>
                  <input 
                    type="text" 
                    placeholder="Skriv inn etternavn"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm transition-all"
                    required
                  />
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">E-postadresse *</label>
                <input 
                  type="email" 
                  placeholder="navn@eksempel.no"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm transition-all"
                  required
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Bekreft e-postadresse *</label>
                <input 
                  type="email" 
                  placeholder="Skriv e-postadressen på nytt"
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4A574]/30 focus:border-[#D4A574] text-sm transition-all"
                  required
                />
              </div>
            </form>
          </div>

          <!-- Summary card -->
          <div class="bg-gray-50 rounded-2xl p-6 border border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Oppsummering</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Verdi på gavekort</span>
                <span class="text-sm font-semibold text-gray-900">kr 250</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Antall gavekort</span>
                <span class="text-sm font-semibold text-gray-900">1</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">Transaksjonskostnad</span>
                <span class="text-sm font-semibold text-gray-900">kr 20</span>
              </div>
              
              <!-- Total with divider -->
              <div class="border-t pt-3 mt-3">
                <div class="flex justify-between items-center">
                  <span class="font-semibold text-gray-900">Totalt å betale</span>
                  <span class="text-lg font-bold text-[#D4A574]">kr 270</span>
                </div>
              </div>
            </div>

            <!-- Terms checkbox -->
            <div class="mt-5">
              <label class="flex items-start gap-3 cursor-pointer group">
                <input type="checkbox" class="mt-0.5 w-4 h-4 rounded border-gray-300 text-[#D4A574] focus:ring-[#D4A574] cursor-pointer" />
                <span class="text-xs text-gray-600 leading-relaxed">
                  Jeg aksepterer iGive sin <a href="#" class="text-[#D4A574] hover:underline font-medium">brukeravtale</a>
                </span>
              </label>
            </div>

            <!-- CTA button with gradient and pulse animation -->
            <button id="payment-btn" class="w-full mt-6 py-4 bg-gradient-to-r from-[#D4A574] to-[#C49560] text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none relative overflow-hidden group" disabled>
              <span class="relative z-10">Gå til betaling</span>
              <span class="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity"></span>
            </button>

            <!-- Validation message -->
            <p class="text-center text-xs text-red-500 mt-3 font-medium">
              Du må fylle inn fornavn
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<!-- Payment success modal -->
<div id="payment-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
  <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 transform transition-all scale-0" id="modal-content">
    <div class="text-center">
      <!-- Success animation container -->
      <div class="w-24 h-24 mx-auto mb-6 relative">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" stroke="#4CAF50" stroke-width="2"/>
          <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" stroke="#4CAF50" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Betaling godkjent!</h2>
      <p class="text-gray-600 mb-6">Behandler din bestilling...</p>
      <div class="flex justify-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#D4A574]"></div>
      </div>
    </div>
  </div>
</div>

<style>
  .checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 2;
    stroke-miterlimit: 10;
    fill: none;
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
  }
  
  .checkmark {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    display: block;
    stroke-width: 2;
    stroke: #4CAF50;
    stroke-miterlimit: 10;
    animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
  }
  
  .checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
  }
  
  @keyframes stroke {
    100% {
      stroke-dashoffset: 0;
    }
  }
  
  @keyframes scale {
    0%, 100% {
      transform: none;
    }
    50% {
      transform: scale3d(1.1, 1.1, 1);
    }
  }
  
  @keyframes fill {
    100% {
      box-shadow: inset 0px 0px 0px 30px #4CAF50;
    }
  }
</style>

<script>
  // Quantity selection
  const quantityBtns = document.querySelectorAll('.quantity-btn');
  let selectedQuantity = 1;
  
  quantityBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Remove active state from all buttons
      quantityBtns.forEach(b => {
        b.classList.remove('bg-[#EDD4B8]', 'hover:bg-[#E5C9A8]');
        b.classList.add('bg-white', 'border-2', 'border-gray-800', 'hover:bg-gray-50');
      });
      
      // Add active state to clicked button
      this.classList.remove('bg-white', 'border-2', 'border-gray-800', 'hover:bg-gray-50');
      this.classList.add('bg-[#EDD4B8]', 'hover:bg-[#E5C9A8]');
      
      // Enable button if form is valid
      checkFormValidity();
    });
  });

  // Amount selection
  const amountBtns = document.querySelectorAll('.amount-btn');
  let selectedAmount = 250;
  
  amountBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Remove active state from all buttons
      amountBtns.forEach(b => {
        b.classList.remove('bg-[#EDD4B8]', 'hover:bg-[#E5C9A8]');
        b.classList.add('bg-white', 'border-2', 'border-gray-800', 'hover:bg-gray-50');
      });
      
      // Add active state to clicked button
      this.classList.remove('bg-white', 'border-2', 'border-gray-800', 'hover:bg-gray-50');
      this.classList.add('bg-[#EDD4B8]', 'hover:bg-[#E5C9A8]');
      
      // Enable button if form is valid
      checkFormValidity();
    });
  });

  // Form validation
  function checkFormValidity() {
    const firstName = document.querySelector('input[placeholder="Skriv inn fornavn"]') as HTMLInputElement;
    const lastName = document.querySelector('input[placeholder="Skriv inn etternavn"]') as HTMLInputElement;
    const email = document.querySelector('input[placeholder="navn@eksempel.no"]') as HTMLInputElement;
    const emailConfirm = document.querySelector('input[placeholder="Skriv e-postadressen på nytt"]') as HTMLInputElement;
    const submitBtn = document.querySelector('button[disabled]') as HTMLButtonElement;
    const errorMsg = document.querySelector('.text-red-500') as HTMLElement;
    
    const isValid = firstName?.value.trim() !== '' && 
                   lastName?.value.trim() !== '' && 
                   email?.value.trim() !== '' && 
                   emailConfirm?.value.trim() !== '' &&
                   email?.value === emailConfirm?.value;
    
    if (isValid) {
      submitBtn?.removeAttribute('disabled');
      if (errorMsg) errorMsg.classList.add('hidden');
    } else {
      submitBtn?.setAttribute('disabled', 'true');
      if (errorMsg) {
        if (!firstName?.value.trim()) {
          errorMsg.textContent = 'Du må fylle inn fornavn';
        } else if (!lastName?.value.trim()) {
          errorMsg.textContent = 'Du må fylle inn etternavn';
        } else if (!email?.value.trim()) {
          errorMsg.textContent = 'Du må fylle inn e-postadresse';
        } else if (!emailConfirm?.value.trim()) {
          errorMsg.textContent = 'Du må bekrefte e-postadressen';
        } else if (email?.value !== emailConfirm?.value) {
          errorMsg.textContent = 'E-postadressene må være like';
        }
        errorMsg.classList.remove('hidden');
      }
    }
  }

  // Add input listeners for validation
  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', checkFormValidity);
  });

  // Payment button click handler
  const paymentBtn = document.getElementById('payment-btn');
  const paymentModal = document.getElementById('payment-modal');
  const modalContent = document.getElementById('modal-content');
  
  paymentBtn?.addEventListener('click', function(e) {
    e.preventDefault();
    
    // Show modal
    paymentModal?.classList.remove('hidden');
    paymentModal?.classList.add('flex');
    
    // Animate modal content
    setTimeout(() => {
      modalContent?.classList.remove('scale-0');
      modalContent?.classList.add('scale-100');
    }, 100);
    
    // Redirect after animation
    setTimeout(() => {
      window.location.href = '/igive-prototype/distribusjon';
    }, 3000);
  });
</script>